From 2b851bac2e206f1f36d3e5e7e1493b5cfbc85de5 Mon Sep 17 00:00:00 2001
From: sreenivasa murthy kolam <sreenivasamurthy.kolam@amd.com>
Date: Thu, 4 May 2023 12:12:36 +0000
Subject: [PATCH] update the original patch for rocm-5.5.0 code

---
 bin/hipcc.pl               | 3 ++-
 hipamd/hip-config.cmake.in | 1 -
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/bin/hipcc.pl b/bin/hipcc.pl
index 2cd3752..e4404f0 100644
--- a/bin/hipcc.pl
+++ b/bin/hipcc.pl
@@ -493,7 +493,8 @@ if($HIP_PLATFORM eq "amd"){
             $targetsStr = $ENV{HCC_AMDGPU_TARGET};
         } elsif (not $isWindows) {
             # Else try using rocm_agent_enumerator
-            $ROCM_AGENT_ENUM = "${ROCM_PATH}/bin/rocm_agent_enumerator";
+            $ROCMINFO_PATH = $ENV{'ROCMINFO_PATH'} // $ROCM_PATH;
+            $ROCM_AGENT_ENUM = "${ROCMINFO_PATH}/bin/rocm_agent_enumerator";
             $targetsStr = `${ROCM_AGENT_ENUM} -t GPU`;
             $targetsStr =~ s/\n/,/g;
         }
diff --git a/hipamd/hip-config.cmake.in b/hipamd/hip-config.cmake.in
index 7c4fe7f..4f2dc19 100755
--- a/hipamd/hip-config.cmake.in
+++ b/hipamd/hip-config.cmake.in
@@ -253,7 +253,6 @@ if(HIP_COMPILER STREQUAL "clang")
   # Add support for __fp16 and _Float16, explicitly link with compiler-rt
   if( "${CLANGRT_BUILTINS_FETCH_EXIT_CODE}" STREQUAL "0" )
     # CLANG_RT Builtins found Successfully Set interface link libraries property
-    set_property(TARGET hip::host APPEND PROPERTY INTERFACE_LINK_LIBRARIES "${CLANGRT_BUILTINS}")
     set_property(TARGET hip::device APPEND PROPERTY INTERFACE_LINK_LIBRARIES "${CLANGRT_BUILTINS}")
   else()
     message(STATUS "clangrt builtins lib not found: ${CLANGRT_BUILTINS_FETCH_EXIT_CODE}")
-- 
2.17.1

